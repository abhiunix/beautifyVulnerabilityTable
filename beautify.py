#!/usr/bin/env python3
import os
import string
from colorit import *
import sys 
import warnings

#Author: Abhijeet Singh (@abhiunix)

#init_colorit()

class bcolors:
    TITLE = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    INFO = '\033[93m'
    OKRED = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    BGRED = '\033[41m'
    UNDERLINE = '\033[4m'
    FGWHITE = '\033[37m'
    FAIL = '\033[95m'

warnings.filterwarnings(action="ignore", message="Python 2 is no longer supported")

def myPrint(text, type):
    if(type=="default"):
        print(bcolors.INFO+text+bcolors.ENDC+"\n")
        return


dict_all = {'Injection': 'High',
            'Broken Authentication': 'High',
            'Sensitive Data Exposure': 'Medium',
            'XML External Entities (XXE)': 'High',
            'Broken Access Control': 'High',
            'Security Misconfiguration': 'Medium',
            'Cross-Site Scripting': 'High',
            'Insecure Deserialization': 'High',
            'Using Components with Known Vulnerabilities': 'Low',
            'Insufficient Logging & Monitoring': 'Medium',
            'Malicious File Upload': 'High',
            'Email-Flooding': 'Low',
            'Email-Harvesting': 'Low',
            'ClickJacking': 'Low'}

dict_final={}

def web():
    #Raw text
    High = 0
    Medium = 0
    Low=0
    count=0

    file_ = open('vulnerabilities.txt', 'r')
    rawData =file_.read()
    file_.close()

    rawData = rawData.replace(', ', '\n')
    rawData = rawData.replace(' and ', '\n')


    beautified = open('Beautify.txt','w')
    beautified.write(rawData)
    beautified.close()

    beautified = open('Beautify.txt','r')

    while True: 
        count += 1
      
        # Get next line from file 
        line = beautified.readline().strip() 

        for key in dict_all:
            if key==line:
                dict_final[key]=dict_all[key]

        # if line is empty 
        # end of file is reached 
        if not line: 
            break
    beautified.close()

    for key in dict_final:
        if dict_final[key]=='High':
            High+=1
        elif dict_final[key]=='Medium':
            Medium+=1
        else:
            Low+=1


    print(color("Vulnerabilities are:", Colors.red))
    print(color("{:<49} {}".format('Vulnerability Name', ' Severity'), Colors.white))

    for key, value in dict_final.items(): 
        vuln, severity = key, value 
        print ("{:<50} {}".format(vuln, severity)) 

    print(color("\nHigh:   "+str(High), Colors.red))
    print(color("Medium: "+str(Medium), Colors.yellow))
    print(color("Low:    "+str(Low), Colors.green))

    Total= High+Medium+Low

    print(color("\nTotal:  "+str(Total), Colors.blue))
    os.system("rm -r Beautify.txt")


def exportTo():
    with open('Vulnerabilities.csv', 'w') as f:
        for key in dict_final.keys():
            f.write("%s,%s\n"%(key,dict_final[key]))

if (len(sys.argv)<2):
    myPrint("Running in default mode for Web.", "default")
    web()
    exit(1);

if (sys.argv[1]=="-h" or sys.argv[1]=="--help"):
    print("Usage:")
    print("       python3 beautify.py [Options] [add|remove|modify|vulnerabilitiesFile]")
    print("")
    print("Options:")
    print("       -h or --help          print the help")
    print("       -f or --file          specify file locations")
    print("       -w or --web           use for web vulnerabilities")
    print("       -m or --mobile        use for mobile vulnerabilities")
    print("       -e or --export        export to csv file")
    print("       -a or --add           adding vulnerabilities")
    print("       -r or --remove        removing vulnerabilities")
    print("")
    print("Examples:")
    print("       python3 beautify.py")
    print("       python3 beautify.py -w")
    print("       python3 beautify.py -m")
    print("       python3 beautify.py -w ./vulnerabilities.txt")
    print("       python3 beautify.py -w ./vulnerabilities.txt --export")
    print("       python3 beautify.py -w --add 'Injection=High'")
    print("       python3 beautify.py -m --remove 'Injection=High'")
    exit(1);
if (sys.argv[1]=="-e" or sys.argv[1]=="--export"):
    web()
    exportTo()
    exit(1);

if (sys.argv[1]=="-w" or sys.argv[1]=="--web"):
    web()
    exit
    
